<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCC Rock Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-serif-elegant { font-family: 'Cormorant Garamond', serif; }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="bg-[#faf9f6] text-slate-900 min-h-screen" x-data="rockApp" x-init="init()" x-cloak>

    <!-- Auth Screen -->
    <template x-if="!user && !loading">
        <div class="fixed inset-0 flex items-center justify-center bg-white z-[100] p-6 text-center">
            <div class="max-w-sm w-full">
                <h1 class="text-5xl font-black uppercase mb-8">My Rocks</h1>
                <button @click="login()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-3 shadow-xl">
                    Sign in with Google
                </button>
            </div>
        </div>
    </template>

    <!-- Main Content -->
    <template x-if="user">
        <div class="p-6 md:p-12 max-w-6xl mx-auto">
            <header class="flex justify-between items-end mb-16">
                <div>
                    <h1 class="text-6xl font-black uppercase tracking-tighter">My Rocks</h1>
                    <p class="text-slate-400 mt-2">Private Workspace for <span x-text="user.displayName"></span></p>
                </div>
                <div class="flex gap-4">
                    <button @click="logout()" class="text-xs font-bold uppercase text-slate-300">Logout</button>
                    <button @click="showNewRockForm = true" class="bg-indigo-600 text-white px-6 py-3 rounded-full font-bold text-xs uppercase">New Rock</button>
                </div>
            </header>

            <div class="grid lg:grid-cols-2 gap-8">
                <template x-for="rock in rocks" :key="rock.id">
                    <div class="bg-white rounded-[2.5rem] p-10 shadow-sm border border-slate-100">
                        <div class="flex justify-between mb-4">
                            <span class="text-[10px] font-black uppercase tracking-widest text-indigo-500" x-text="rock.pathway"></span>
                            <button @click="deleteRock(rock.id)" class="text-slate-200 hover:text-red-500">Delete</button>
                        </div>
                        <h3 class="text-4xl font-serif-elegant italic mb-4" x-text="rock.title"></h3>
                        <p class="text-slate-500 mb-8" x-text="rock.description"></p>
                        
                        <div class="space-y-3">
                            <template x-for="(step, idx) in rock.battlePlan" :key="idx">
                                <div @click="toggleStep(rock, idx)" class="flex items-center gap-3 cursor-pointer">
                                    <div class="w-5 h-5 border-2 rounded" :class="step.completed ? 'bg-emerald-500 border-emerald-500' : 'border-slate-200'"></div>
                                    <span :class="step.completed ? 'line-through text-slate-300' : ''" x-text="step.task"></span>
                                </div>
                            </template>
                            <input @keydown.enter="addStep(rock, $event)" placeholder="+ Add step..." class="w-full mt-4 bg-transparent italic outline-none">
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </template>

    <!-- Modal -->
    <template x-if="showNewRockForm">
        <div class="fixed inset-0 z-[200] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-md">
            <div class="bg-white rounded-[3rem] p-12 w-full max-w-xl">
                <h2 class="text-4xl font-black mb-8">New Goal</h2>
                <input x-model="newRock.title" placeholder="Rock Title" class="w-full p-4 bg-slate-50 rounded-xl mb-4 outline-none">
                <select x-model="newRock.pathway" class="w-full p-4 bg-slate-50 rounded-xl mb-4 outline-none">
                    <option>Connect</option><option>Grow</option><option>Commit</option><option>Multiply</option>
                </select>
                <textarea x-model="newRock.description" placeholder="Description" class="w-full p-4 bg-slate-50 rounded-xl mb-8 outline-none h-32"></textarea>
                <div class="flex gap-4">
                    <button @click="showNewRockForm = false" class="flex-1 font-bold">Cancel</button>
                    <button @click="createRock()" class="flex-1 bg-indigo-600 text-white py-4 rounded-xl font-bold">Save Rock</button>
                </div>
            </div>
        </div>
    </template>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithPopup, GoogleAuthProvider, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBKr64C6yyV4uFkRlmeNBvVyFjJZe6kfDw",
            authDomain: "ncc-rock-tracker.firebaseapp.com",
            projectId: "ncc-rock-tracker",
            storageBucket: "ncc-rock-tracker.firebasestorage.app",
            messagingSenderId: "134627686862",
            appId: "1:134627686862:web:00fc4945a290cf7ee2939f",
            measurementId: "G-D5LP166V7R"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        document.addEventListener('alpine:init', () => {
            Alpine.data('rockApp', () => ({
                user: null, loading: true, rocks: [], showNewRockForm: false,
                newRock: { title: '', pathway: 'Connect', description: '' },
                init() {
                    onAuthStateChanged(auth, (u) => {
                        this.user = u; this.loading = false;
                        if (u) {
                            const q = query(collection(db, "users", u.uid, "rocks"), orderBy("createdAt", "desc"));
                            onSnapshot(q, s => this.rocks = s.docs.map(d => ({ id: d.id, ...d.data() })));
                        }
                    });
                },
                async login() { await signInWithPopup(auth, new GoogleAuthProvider()); },
                async logout() { await signOut(auth); },
                async createRock() {
                    await addDoc(collection(db, "users", this.user.uid, "rocks"), { ...this.newRock, battlePlan: [], createdAt: serverTimestamp() });
                    this.showNewRockForm = false;
                },
                async toggleStep(r, i) {
                    const plan = [...r.battlePlan]; plan[i].completed = !plan[i].completed;
                    await updateDoc(doc(db, "users", this.user.uid, "rocks", r.id), { battlePlan: plan });
                },
                async addStep(r, e) {
                    const plan = [...r.battlePlan, { task: e.target.value, completed: false }];
                    await updateDoc(doc(db, "users", this.user.uid, "rocks", r.id), { battlePlan: plan });
                    e.target.value = '';
                },
                async deleteRock(id) { await deleteDoc(doc(db, "users", this.user.uid, "rocks", id)); }
            }));
        });
    </script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</body>
</html>
 
